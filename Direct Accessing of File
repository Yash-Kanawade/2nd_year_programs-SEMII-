#include<iostream>
#include<fstream>
using namespace std;
const int TABLESIZE = 50;

struct Record{
    int data;
    Record(){
        data = -1;
    }
};

void initializeFile(){
    fstream file("file.txt", ios::in | ios::binary);
    if (file) {
        file.close();
        return;
    }

    file.open("file.txt", ios::out | ios::binary);
    Record r;
    for (int i = 0; i < TABLESIZE; i++) {
        file.write((char*)&r, sizeof(r));
    }
    file.close();
}


int hashFuc(int key){
    return key%TABLESIZE;
}

Record readData(int pos){
    Record r;
    fstream file("file.txt",ios::in | ios::binary);
    file.seekg(pos*sizeof(Record));
    file.read((char*)(&r),sizeof(r));
    file.close();
    return r;
}

void writeData(int pos,Record r){
    fstream file("file.txt",ios::in | ios::out |ios::binary);
    file.seekg(pos*sizeof(Record));
    file.write((char*)&r,sizeof(r));
    file.close();
}

void addData(int key) {
    int index = hashFuc(key);

    for(int i = 0 ; i < TABLESIZE;i++){
        int pos = (index + i) % TABLESIZE;
        Record r = readData(pos);
        if(r.data == -1){
            r.data = key;
            writeData(pos,r);
            cout<<"Record inserted at postion :"<<pos<<endl;
            return;
        }
    }
    cout<<"Table is full !!!"<<endl;
}

void removeData(int key){
    int index = hashFuc(key);
    for(int i = 0 ; i < TABLESIZE;i++){
        int pos = (index+i)%TABLESIZE;
        Record r = readData(pos);
        if(r.data == key){
            r.data = -1;
            writeData(pos, r);
            cout<<"Data found!! And deleted successfully!!"<<endl;
            return;
        }
    }

    cout<<"Data not found!!"<<endl;
}

void displayData(){
    cout<<"The content of table is has follows:-"<<endl;
    for(int i = 0 ; i < TABLESIZE;i++){
        Record r = readData(i);
        if(r.data != -1){
            cout<<"The data at position "<<i<<" is :"<<r.data<<endl;
        }
    }
    cout<<endl;
}

void search(int key){
    int index = hashFuc(key);
    for(int i = 0 ; i < TABLESIZE;i++){
        int pos = (index+i)%TABLESIZE;
        Record r = readData(pos);
        if(r.data == key){
            cout<<"Data found!!"<<endl;
            return;
        }
    }
    cout<<"Data not found!!"<<endl;
}

int main(){
    initializeFile();
    addData(3);
    cout<<endl;
    displayData();
    cout<<endl;
    addData(5);
    cout<<endl;
    displayData();
    cout<<endl;
    removeData(3);
    cout<<endl;
    displayData();
    cout<<endl;
    search(5);
    return 0;
}
